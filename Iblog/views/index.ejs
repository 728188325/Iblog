<%- include('./partials/header.ejs') %>
	<title>神奇的海蛎仔个人博客</title>
</head>
<body>
	<%- include("./partials/nav.ejs",{currentUrl:"/"}) %>
	<div class="main">
		<div class="main-left">
			<%- include('./partials/swiper.ejs') %>
			<div class="main-left-title"><i class="fa fa-feed"></i>最新文章</div>
			<div class="main-content">

			</div>
			<div class="box m-style"></div>
		</div>
		<%- include("./partials/right.ejs") %>
		
	</div>
	<%- include("./partials/footer.ejs") %>
	<script id="article-list" type="text/html">
		{{each $data val key}}
		<div class="main-item">
			<div class="blog-title">
				<h1><a title="{{val.title}}" class="title-link anim-link"
						href="/articles/detail?id={{val._id}}">{{val.title}}</a></h1>
			</div>
			<div class="blog-info">
				<div class="title-info-list clearfix">
					<a class="title-date" href="javascript:;">{{val.createTime}}</a>
					<a class="title-sort" href="javascript:;">{{val.thumbUp||0}}</a>
					<a class="title-clicks" href="javascript:;">{{val.readNum||0}}</a>
					<a class="title-cmt" href="javascript:;">0</a>
				</div>
			</div>
			<div class="blog-content">
				{{if val.imgUrl }}
				<a class="blog-link" href="/articles/detail?id={{val._id}}" 
				 style="background-image:url({{val.imgUrl}});">
				</a>
				{{/if}}
				<div class="blog-content-fl">
					<div class="blog-text">
						{{val.introduction}}
					</div>
					<a class="blog-show" href="/articles/detail?id={{val._id}}">阅读全文>></a>
				</div>
			</div>
		</div>
		{{/each}}
	</script>
	<script>
		$(function () {
			articleListInit(1,5);
	
			var galleryThumbs = new Swiper('.gallery-thumbs', {
				spaceBetween: 10,
				slidesPerView: 4,
				freeMode: false,
				watchSlidesVisibility: true,
				watchSlidesProgress: true,
				autoplay: true,
				direction: 'vertical',
				loop: true
			});
			var galleryTop = new Swiper('.gallery-top', {
				spaceBetween: 10,
				autoplay: true,
				loop: true,
				navigation: {
					/* nextEl: '.swiper-button-next',
					prevEl: '.swiper-button-prev', */
				},
				thumbs: {
					swiper: galleryThumbs,
				},
			});
		});
		/**
		 * @description: 初始化请求加载文章列表数据
		 * @param page{Number} 当前页
		 * @param limit{Number} 每页显示数据量
		 * @param type{String} 文章类型
		 * @return: 
		 */
		function articleListInit(page,limit,type){
			page = page?page:1;
			limit = limit?limit:5;
			if(typeof type=="undefined"){
				type = "";
			}else{
				type = "&type="+type;
			}
			let url = "/articles?page="+page+"&limit="+limit+type;
			$.ajax({
				type: "GET",
				url: url,
				dataType:"json",
				xhrFields:{
					withCredentials:true
				},
				success: (data) => {
					if(data.status==200){
						if(data.count>0){
							var _html = template('article-list',data.data);
							$(".main-content").html(_html);
							setArticleListPager(page, limit, data.count,type);
						}else{
							$(".main-content").html("暂无相关数据");
						}
					}
				}
			})
		}
		/**
		 * @description: 设置文章列表分页
		 * @param current{Number} 当前页
		 * @param pageSize{Number} 每页显示数据量
		 * @param total{Number} 总数据量
		 * @param type{Number} 文章类型
		 * @return: 
		 */
		function setArticleListPager(current, pageSize, total,type){
			$('.box').pagination({
				mode: 'fixed',
				current: current,
				totalData: total,
				showData: pageSize,
				coping: true,
				homePage: '首页',
				endPage: '末页',
				callback: function (api) {
					let page = api.getCurrent();
					limit = pageSize;
					let url = "/articles?page="+page+"&limit="+limit+type;
					$.ajax({
						type: "GET",
						url: url,
						dataType:"json",
						xhrFields:{
							withCredentials:true
						},
						success: (data) => {
							var _html = template('article-list',data.data);
							$(".main-content").html(_html);
						}
					})
				}
			});
		}
	</script>
	

</body>

</html>